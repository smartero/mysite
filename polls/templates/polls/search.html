{% extends 'polls/layout.html' %}

{% block main %}
<script src="https://api-maps.yandex.ru/2.1/?apikey=<515f3159-bfbe-4a5b-9067-a36951149219>&lang=en_US" type="text/javascript"></script>
<script type='text/javascript'>
  ymaps.ready(init);
  function init(){
    var suggestView1 = new ymaps.SuggestView('dep_address');    
    var suggestView2 = new ymaps.SuggestView('arr_address');    
  };
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#pax').addEventListener('keyup', function(){
      var input = parseInt(document.querySelector('#pax').value);
      var seats = document.querySelectorAll('#seats');
      for (i = 0; i < seats.length; i++) {
        var number = parseInt(seats[i].innerHTML);
        seats[i].parentElement.style.display = (number < input ? 'none': '');
      };
    });
  });
</script>
<script>
  $(document).ready(function() {
    $( "#dep_date" ).datepicker();
  });
</script>
<script>
$(document).ready(function(){
  document.querySelector('#date').addEventListener('change', function(){
  var date_r = querySelector('#date')
  var date_t = querySelector('#date_trip')
  var date_request = getDate(new Date(date_request.value));
  var date_trip = getDate(new Date(date_trip.value));
  date_r.parentElement.style.display = (date_request < date_trip ? 'none': '');
});
});
</script>
  <h2>Search for a trip</h2>
  <br>
  <form class="form-group"  autocomplete="off">
    <div class='row'>
    <div class="col">
      
      <label for="dep_address">From:</label>   
      <input class="form-control" id="dep_address" type="search">
    </div>
    <div class="col">
      <label for="arr_address">To:</label>   
      <input class="form-control" id="arr_address" type="search">
    </div>
    <div class="col">
      <label for="date">Date:</label>
      <input class="form-control" id="dep_date">
    </div>
    <div class="col">
      <label for="">Passengers:</label>
      <input class="form-control" id="pax">
    </div>
  </div>
</form>

<table class="table table-sm" id="example">
  <thead>
    <tr>
      <th style='width: 20%'>From</th>
      <th style='width: 20%'>To</th>
      <th>Date</th>
      <th>Free seats</th>
      <th>Driver</th>
      <th></th>
      </th>
    </tr>
  </thead>
  {% for result in results %}
  <tbody>
    <tr>
      <td>{{ result.dep_address }}</td>
      <td>{{ result.arr_address }}</td>
      <td id='date_trip'>{{ result.dep_date }}</td>
      <td id='seats'>{{ result.seats }}</td>
      <td>{{ result.user }}</td>
      <td><img class="img-thumbnail float-left" id="avatar" src="{{ result.user.profile.avatar.url }}" alt=""/></td>
    </tr>
  </tbody>
  {% endfor %}
</table>

{% endblock %}